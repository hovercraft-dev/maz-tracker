<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#0d1117">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="manifest" href="manifest.json">
<link rel="icon" href="icon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="icon.svg">
<title>Health Tracker</title>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  html, body {
    height: 100%;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    background: #0d1117;
    color: #c9d1d9;
    -webkit-tap-highlight-color: transparent;
  }

  body {
    display: flex;
    justify-content: center;
    padding: 2rem 1.25rem 4rem;
  }

  .app {
    width: 100%;
    max-width: 400px;
  }

  h1 {
    font-size: 1.5rem;
    font-weight: 700;
    letter-spacing: -0.02em;
    color: #e6edf3;
    margin-bottom: 1.75rem;
  }

  /* ── Section headings ── */
  .section-label {
    font-size: 0.65rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: #484f58;
    margin-bottom: 0.75rem;
    margin-top: 1.75rem;
  }

  .section-label:first-of-type { margin-top: 0; }

  /* ── Inputs ── */
  .field { margin-bottom: 1rem; }

  label {
    display: block;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: #7d8590;
    margin-bottom: 0.4rem;
  }

  input[type="date"],
  input[type="number"],
  textarea {
    width: 100%;
    padding: 0.9rem 1rem;
    font-size: 1.15rem;
    font-weight: 500;
    font-family: inherit;
    color: #e6edf3;
    background: #161b22;
    border: 1.5px solid #30363d;
    border-radius: 10px;
    outline: none;
    transition: border-color 0.15s;
    -webkit-appearance: none;
  }

  input:focus, textarea:focus { border-color: #c4a0f5; }

  .unit { position: relative; }
  .unit::after {
    content: attr(data-unit);
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    font-size: 0.85rem;
    font-weight: 600;
    color: #484f58;
    pointer-events: none;
  }
  .unit input { padding-right: 3rem; }

  /* ── Medication checkboxes ── */
  .med-item {
    display: flex;
    align-items: center;
    gap: 0.85rem;
    background: #161b22;
    border: 1.5px solid #30363d;
    border-radius: 10px;
    padding: 0.85rem 1rem;
    margin-bottom: 0.6rem;
    cursor: pointer;
    transition: border-color 0.15s;
    -webkit-user-select: none;
    user-select: none;
  }

  .med-item:has(input:checked) { border-color: #c4a0f5; }

  .med-item input[type="checkbox"] { display: none; }

  .check-box {
    width: 28px;
    height: 28px;
    border-radius: 7px;
    border: 2px solid #30363d;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.15s, border-color 0.15s;
  }

  .med-item input:checked + .check-box {
    background: #c4a0f5;
    border-color: #c4a0f5;
  }

  .check-box svg {
    width: 16px;
    height: 16px;
    opacity: 0;
    transition: opacity 0.15s;
  }

  .med-item input:checked + .check-box svg { opacity: 1; }

  .med-text { flex: 1; }

  .med-name {
    font-size: 1rem;
    font-weight: 600;
    color: #e6edf3;
  }

  .med-detail {
    font-size: 0.75rem;
    color: #7d8590;
    margin-top: 0.1rem;
  }

  /* ── Testosterone side toggle ── */
  .testo-row {
    background: #161b22;
    border: 1.5px solid #30363d;
    border-radius: 10px;
    padding: 0.85rem 1rem;
    margin-bottom: 0.6rem;
  }

  .testo-top {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .side-toggle {
    display: flex;
    background: #0d1117;
    border-radius: 8px;
    overflow: hidden;
    border: 1.5px solid #30363d;
  }

  .side-btn {
    padding: 0.45rem 1.1rem;
    font-size: 0.85rem;
    font-weight: 700;
    font-family: inherit;
    color: #7d8590;
    background: transparent;
    border: none;
    cursor: pointer;
    transition: background 0.15s, color 0.15s;
    -webkit-appearance: none;
  }

  .side-btn.active {
    background: #c4a0f5;
    color: #0d1117;
  }

  /* ── Notes ── */
  .notes-toggle {
    display: inline-block;
    font-size: 0.8rem;
    font-weight: 600;
    color: #7d8590;
    cursor: pointer;
    margin-top: 0.5rem;
    margin-bottom: 0.5rem;
    border: none;
    background: none;
    font-family: inherit;
    padding: 0;
  }

  .notes-toggle:hover { color: #c4a0f5; }

  .notes-area {
    display: none;
    margin-top: 0.5rem;
  }

  .notes-area.open { display: block; }

  textarea {
    min-height: 5rem;
    resize: vertical;
    line-height: 1.5;
  }

  /* ── Submit ── */
  button[type="submit"] {
    width: 100%;
    padding: 1rem;
    margin-top: 1.25rem;
    font-size: 1.1rem;
    font-weight: 700;
    font-family: inherit;
    color: #0d1117;
    background: #c4a0f5;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    transition: opacity 0.15s;
    -webkit-appearance: none;
  }

  button[type="submit"]:active { opacity: 0.8; }
  button[type="submit"]:disabled { opacity: 0.4; cursor: not-allowed; }

  /* ── Toast ── */
  .toast {
    position: fixed;
    bottom: 2rem;
    left: 50%;
    transform: translateX(-50%) translateY(120%);
    background: #1c1d2e;
    color: #c4a0f5;
    font-size: 0.9rem;
    font-weight: 600;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    border: 1px solid #3d2e6b;
    opacity: 0;
    transition: transform 0.3s ease, opacity 0.3s ease;
    pointer-events: none;
  }

  .toast.show {
    transform: translateX(-50%) translateY(0);
    opacity: 1;
  }
</style>
</head>
<body>

<div class="app">
  <h1>Health Tracker</h1>
  <form id="form">

    <!-- ── Metrics ── -->
    <div class="section-label">Metrics</div>

    <div class="field">
      <label for="weight">Weight</label>
      <div class="unit" data-unit="kg">
        <input type="number" id="weight" inputmode="decimal" step="0.1" min="0" max="300" placeholder="0.0" required>
      </div>
    </div>
    <div class="field">
      <label for="waist">Waist</label>
      <div class="unit" data-unit="cm">
        <input type="number" id="waist" inputmode="decimal" step="0.1" min="0" max="200" placeholder="0.0" required>
      </div>
    </div>
    <div class="field">
      <label for="hips">Hips</label>
      <div class="unit" data-unit="cm">
        <input type="number" id="hips" inputmode="decimal" step="0.1" min="0" max="200" placeholder="0.0" required>
      </div>
    </div>

    <!-- ── Medication ── -->
    <div class="section-label">Medication</div>

    <label class="med-item" for="oestrogen">
      <input type="checkbox" id="oestrogen">
      <span class="check-box">
        <svg viewBox="0 0 24 24" fill="none" stroke="#0d1117" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="20 6 9 17 4 12"/>
        </svg>
      </span>
      <span class="med-text">
        <span class="med-name">Oestrogen</span>
        <span class="med-detail">Sandrena 1mg — daily</span>
      </span>
    </label>

    <label class="med-item" for="progesterone">
      <input type="checkbox" id="progesterone">
      <span class="check-box">
        <svg viewBox="0 0 24 24" fill="none" stroke="#0d1117" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="20 6 9 17 4 12"/>
        </svg>
      </span>
      <span class="med-text">
        <span class="med-name">Progesterone</span>
        <span class="med-detail">Getrepix 100mg — daily</span>
      </span>
    </label>

    <div class="testo-row">
      <div class="testo-top">
        <span class="med-text">
          <span class="med-name">Testosterone</span>
          <span class="med-detail">Topical — alternate sides</span>
        </span>
        <div class="side-toggle">
          <button type="button" class="side-btn" data-side="left">L</button>
          <button type="button" class="side-btn" data-side="right">R</button>
        </div>
      </div>
    </div>

    <!-- ── Notes ── -->
    <button type="button" class="notes-toggle" id="notesToggle">Add a note +</button>
    <div class="notes-area" id="notesArea">
      <textarea id="notes" placeholder="Optional notes..."></textarea>
    </div>

    <button type="submit">Submit</button>
  </form>
</div>

<div class="toast" id="toast">Logged</div>

<script>
const FORM_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSeaU5fwW_xqpxSr1VxJL6SvTpwxA_DrrPnphMq2M01TFXTw3Q/formResponse';
const FIELDS = {
  weight:     'entry.841388769',
  waist:      'entry.1933747550',
  hips:       'entry.1558876293',
  medication: 'entry.208895798',
  notes:      'entry.2144247428'
};

const form = document.getElementById('form');
const toast = document.getElementById('toast');
const notesToggle = document.getElementById('notesToggle');
const notesArea = document.getElementById('notesArea');
const sideBtns = document.querySelectorAll('.side-btn');

// ── Date helper ──
function todayStr() {
  const d = new Date();
  return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
}

// ── Testosterone side logic ──
function getSuggestedSide() {
  const stored = localStorage.getItem('testo_last');
  if (!stored) return 'left';
  try {
    const { side, date } = JSON.parse(stored);
    if (date === todayStr()) return side;
    return side === 'left' ? 'right' : 'left';
  } catch { return 'left'; }
}

function saveSide(side) {
  localStorage.setItem('testo_last', JSON.stringify({ side, date: todayStr() }));
}

let selectedSide = getSuggestedSide();

function updateSideUI() {
  sideBtns.forEach(btn => {
    btn.classList.toggle('active', btn.dataset.side === selectedSide);
  });
}

sideBtns.forEach(btn => {
  btn.addEventListener('click', () => {
    selectedSide = btn.dataset.side;
    updateSideUI();
  });
});

// ── Notes toggle ──
notesToggle.addEventListener('click', () => {
  const open = notesArea.classList.toggle('open');
  notesToggle.textContent = open ? 'Hide note −' : 'Add a note +';
});

// ── Toast ──
function showToast() {
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 1800);
}

// ── Reset ──
function resetForm() {
  form.reset();
  notesArea.classList.remove('open');
  notesToggle.textContent = 'Add a note +';
  selectedSide = getSuggestedSide();
  updateSideUI();
}

// ── Submit ──
form.addEventListener('submit', async (e) => {
  e.preventDefault();
  const btn = form.querySelector('button[type="submit"]');
  btn.disabled = true;

  const params = new URLSearchParams();
  params.append(FIELDS.weight, document.getElementById('weight').value);
  params.append(FIELDS.waist, document.getElementById('waist').value);
  params.append(FIELDS.hips, document.getElementById('hips').value);

  // Medication: append each checked item as a separate value for the same field
  if (document.getElementById('oestrogen').checked) {
    params.append(FIELDS.medication, 'Oestrogen (Sandrena, 1mg)');
  }
  if (document.getElementById('progesterone').checked) {
    params.append(FIELDS.medication, 'Progesterone (Getrepix, 100mg)');
  }
  const testoLabel = selectedSide === 'left' ? 'Testosterone (Left)' : 'Testosterone (Right)';
  params.append(FIELDS.medication, testoLabel);

  params.append(FIELDS.notes, document.getElementById('notes').value.trim());

  try {
    await fetch(FORM_URL, {
      method: 'POST',
      mode: 'no-cors',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: params.toString()
    });
    saveSide(selectedSide);
    showToast();
    resetForm();
  } catch (err) {
    alert('Failed to send. Check your connection.');
  } finally {
    btn.disabled = false;
  }
});

// ── Init ──
updateSideUI();

// ── Service worker ──
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./sw.js');
}
</script>

</body>
</html>
